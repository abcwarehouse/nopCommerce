@model AbcWarehouse.Plugin.Misc.SearchSpring.Models.SearchResultModel
@inherits Nop.Web.Framework.Mvc.Razor.NopRazorPage<AbcWarehouse.Plugin.Misc.SearchSpring.Models.SearchResultModel>
@inject Nop.Services.Catalog.IProductService productService
@using Nop.Web.Models.Catalog
@using Nop.Web.Factories
@using Nop.Core.Infrastructure

@{
    Layout = "~/Views/Shared/_ColumnsTwo.cshtml";
}

@{
    var query = Context.Request.Query["q"].ToString();
    var productModelFactory = EngineContext.Current.Resolve<IProductModelFactory>();
    var matchingProducts = new List<Nop.Core.Domain.Catalog.Product>();
}

<h2>Search Results</h2>

@{
foreach (var item in Model.Results)
    {
        var product = await productService.GetProductBySkuAsync(item.Sku);
        if (product != null)
        {
            matchingProducts.Add(product);
        }
    }

    var productBoxes = productModelFactory.PrepareProductOverviewModels(
        matchingProducts,
        preparePriceModel: true,
        preparePictureModel: true
    );
}

@foreach (var productModel in productBoxes)
{
    await Html.RenderPartialAsync("_ProductBox", productModel);
}





@if (!Model.Results.Any())
{
    <p>No products found.</p>
}
else
{
    <div class="products-container">
        <div class="products-wrapper">
            <div class="product-grid">
                <div class="item-grid">
                    
                    @foreach (var product in Model.Results)
                    {
                        <div class="item-box">
                            <div class="product-item">
                                <h2 class="product-title">
                                    <a href="@product.ProductUrl"><span>@product.Brand</span><span class="man-no">@product.ItemNumber</span></a>
                                </h2>
                                <div class="picture">
                                    <a href="@product.ProductUrl">
                                        <div class="image-container">
                                            <img src="@product.ImageUrl" alt="@product.Name" />
                                        </div>
                                    </a>
                                </div>
                                <div class="add-info">
                                    <p class="item-number item-number-style">@product.Sku</p>
                                    <h2 class="product-title"><a href="@product.ProductUrl">@product.Name</a></h2>
                                    <div class="prices">
                                        <span class="price old-price">Compare at @product.RetailPrice</span>
                                        <span class="price you-save">$ Off</span>
                                        <span class="price-sale-tag">Sale</span>
                                        <span class="price actual-price">@product.Price</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    }
