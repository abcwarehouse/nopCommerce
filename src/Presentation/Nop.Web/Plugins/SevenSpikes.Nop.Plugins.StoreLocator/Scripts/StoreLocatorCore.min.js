!function(t,e){var a,n,o,i,r,s,d,l,c=!1,p=!1,u=[],m=RegExp(/^-?\d+\.?\d*$/);function g(t,e){var o=new google.maps.LatLng(t.lat,t.lng),i=new google.maps.Marker({position:o,title:t.title,draggable:e});"true"!==n.attr("data-manuallysetmapbounds")&&(l.extend(o),s.setCenter(o)),i.setMap(s),u.push(i),"shopDetailsMap"!=a.type&&google.maps.event.addListener(i,"click",function(){var e="<h5>"+t.title+"</h5>",a=t.shortdescription;a&&(e+="<div>"+a+"</div>"),new google.maps.InfoWindow({maxWidth:400,content:e}).open(s,i)})}function f(e){if(c)d.setPosition(e);else{var o={map:s,position:e,icon:n.attr("data-pathtoimages")+"/squat_marker_green_thumb.png",animation:google.maps.Animation.DROP,title:n.attr("data-youarehere"),draggable:!0},i=new google.maps.Marker(o);i.setMap(s),d=i,c=!0,google.maps.event.addListener(i,"dragend",function(){t.event.trigger({type:"userPositionChanged",position:d.position})})}t(a.getCurrentLocationSelector).hide(),t.event.trigger({type:"userPositionChanged",position:d.position})}e.appendMapScript=function(e){if(e){var o=(n=t((a=e).resourcesSelector)).attr("data-googleapikey").trim(),i=n.attr("data-maplanguagecode").trim();o&&(a.source+="&key="+o),i&&(a.source+="&language="+i);var r=document.createElement("script");r.src=a.source,document.body.appendChild(r)}},e.initializeMap=function(){var t=document.getElementById(a.wrapperId),o={center:new google.maps.LatLng(a.centerLatitude,a.centerLongitude),zoom:a.initialZoom,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:function t(){var e=n.attr("data-mapstyles"),a="";if(!e)return"";try{a=JSON.parse(e)}catch(o){console.log("Invalid custom map styles value!")}return a}()};s=new google.maps.Map(t,o),google.maps.event.addListenerOnce(s,"idle",function(){(function t(){var a=function t(){var e=[],a=n.attr("data-markersdata");if(a)for(var o=JSON.parse(a),i=0;i<o.length;i++){var r=o[i].Latitude,s=o[i].Longitude;if(null!=r&&null!=s&&m.test(r)&&m.test(s)){var d={id:o[i].Id,lat:r,lng:s,title:o[i].Name,shortdescription:o[i].ShortDescription};e[i]=d}}var l=n.attr("data-shoplatitude"),c=n.attr("data-shoplongitude"),p=n.attr("data-shopname");return l&&c&&(e[0]={lat:l,lng:c,title:p}),e}();if(0!=a.length){l=new google.maps.LatLngBounds;for(var o=0;o<a.length;o++)null!=a[o]&&g(a[o],!1);"true"!==n.attr("data-manuallysetmapbounds")&&e.alignMap(),"undefined"!=typeof MarkerClusterer&&(r=new MarkerClusterer(s,u))}})()})},e.showDirectionsToShop=function(r,l,p){if(void 0===o&&(o=new google.maps.DirectionsService),void 0===i&&(i=new google.maps.DirectionsRenderer).setPanel(document.getElementById(a.directionsPanelId)),c){if(r&&l)destination=new google.maps.LatLng(r,l);else{if(!u[0]||!u[0].position)return;destination=u[0].position}var m="Imperial"==n.attr("data-units"),g={origin:d.position,destination:destination,travelMode:google.maps.TravelMode.DRIVING,unitSystem:m?google.maps.UnitSystem.IMPERIAL:google.maps.UnitSystem.METRIC};o.route(g,function(o,r){r==google.maps.DirectionsStatus.OK?(i.setMap(s),i.setDirections(o),e.displayInformationMessage(""),t(a.directionsContainer).addClass(a.directionsShownClass),e.clearMarkers()):(e.displayInformationMessage(n.attr("data-unabletoshowdirections")),t(a.directionsContainer).removeClass(a.directionsShownClass),e.clearMapRoute()),p&&t("html,body").animate({scrollTop:t(p).offset().top},"slow")})}},e.clearMapRoute=function(){void 0!==i&&(i.setMap(null),p&&e.showMarkers())},e.createUserMarker=function(t){return new Promise(function(a,o){new Promise(function(t,e){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t(e.coords)},function(t){e(t)})}).then(function(t){f(new google.maps.LatLng(t.latitude,t.longitude)),a(d)}).catch(function(o){t?(f(new google.maps.LatLng(s.center.lat(),s.center.lng())),a(d)):a(),e.displayInformationMessage(n.attr("data-geolocationdenied"))})})},e.zoomMapToSelectedSearchRadius=function(){let o=parseFloat(t(a.radiusFieldSelector).val());if(isNaN(o)&&(o=parseFloat("2000")),!(!c&&isNaN(o))||!(o<=0)){"Imperial"===n.attr("data-units")&&(o*=1.609344),o>5e3&&(o=5e3);var i=new google.maps.Circle({center:d.getPosition(),map:s,visible:!1,zIndex:0,radius:1e3*o});e.alignMap(i.getBounds()),s.setZoom(s.getZoom()+2)}},e.createMapSearchBox=function(){var n=document.getElementById(a.mapSearchInputId);s.controls[google.maps.ControlPosition.TOP_LEFT].push(n);var o=new google.maps.places.Autocomplete(n,{fields:["formatted_address","place_id","name","geometry"]});n.style.display="block",o.addListener("place_changed",function(){var n=o.getPlace();n.geometry&&n.geometry.location&&(f(n.geometry.location),t(a.directionsContainer).removeClass(a.directionsShownClass),e.clearMapRoute(),e.zoomMapToSelectedSearchRadius())})},e.alignMap=function(t){"true"!=n.attr("data-manuallysetmapbounds")||t?(s.fitBounds(t||l),google.maps.event.addListenerOnce(s,"bounds_changed",function(t){var e=parseInt(n.attr("data-mapzoomlevel"))||15;this.setZoom(Math.min(e,this.getZoom()))})):(s.setCenter(new google.maps.LatLng(a.centerLatitude,a.centerLongitude)),s.setZoom(a.initialZoom))},e.displayInformationMessage=function(e,a){a||(a=".additional-info"),t(a).text(e)},e.showMarkers=function(){for(var t=0;t<u.length;t++)u[t].setMap(s);void 0!==r&&(r=new MarkerClusterer(s,u)),p=!1},e.clearMarkers=function(){for(var t=0;t<u.length;t++)u[t].setMap(null);void 0!==r&&r.clearMarkers(),p=!0}}(jQuery,window.storeLocatorCore=window.storeLocatorCore||{});