@model ProductDetailsModel
@{
    Html.AddScriptParts(ResourceLocation.Footer, "~/lib_npm/magnific-popup/jquery.magnific-popup.min.js");
    Html.AddCssFileParts("~/lib_npm/magnific-popup/magnific-popup.css");
}

<div class="gallery">
    @await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.ProductDetailsBeforePictures, additionalData = Model })

    <div class="picture">
        <!-- Main product image always wrapped in anchor for fullscreen popup -->
        <a href="@Model.DefaultPictureModel.FullSizeImageUrl"
           title="@Model.DefaultPictureModel.Title"
           id="main-product-img-lightbox-anchor-@Model.Id">
            <img id="main-product-img-@Model.Id"
                 src="@Model.DefaultPictureModel.ImageUrl"
                 alt="@Model.DefaultPictureModel.AlternateText"
                 title="@Model.DefaultPictureModel.Title" />
        </a>
    </div>

    @* Thumbnails section *@
    @if (Model.PictureModels.Count > 1)
    {
        <div class="picture-thumbs">
            @foreach (var picture in Model.PictureModels)
            {
                <a class="thumb-item"
                   href="@picture.FullSizeImageUrl"
                   title="@picture.Title">
                    <img src="@picture.ThumbImageUrl"
                         alt="@picture.AlternateText"
                         title="@picture.Title"
                         data-defaultsize="@picture.ImageUrl"
                         data-fullsize="@picture.FullSizeImageUrl" />
                </a>
            }
        </div>
    }

    @await Component.InvokeAsync("Widget", new { widgetZone = PublicWidgetZones.ProductDetailsAfterPictures, additionalData = Model })
</div>

<script asp-location="Footer">
    $(function () {
        // Main image fullscreen popup
        $('#main-product-img-lightbox-anchor-@Model.Id').magnificPopup({
            type: 'image',
            closeOnContentClick: true,
            mainClass: 'mfp-img-mobile',
            image: { verticalFit: true }
        });

        // Thumbnail gallery popup
        $('.picture-thumbs').magnificPopup({
            type: 'image',
            delegate: 'a',
            gallery: { enabled: true }
        });

        // Swap main image when a thumbnail is clicked
        $('.thumb-item > img').on('click', function () {
            $('#main-product-img-@Model.Id')
                .attr('src', $(this).data('defaultsize'))
                .attr('alt', $(this).attr('alt'))
                .attr('title', $(this).attr('title'));
            $('#main-product-img-lightbox-anchor-@Model.Id')
                .attr('href', $(this).data('fullsize'))
                .attr('title', $(this).attr('title'));
        });
    });
</script>


